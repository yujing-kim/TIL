# ê°œì¸ì´ DevOps ì‹œì‘í•˜ê¸°1

## ğŸ˜™ Vagrantë¡œ **Local ê°œë°œ í™˜ê²½ì˜ Infrastructure as Code í™”(P58)**

- Vagrant â‡’ í•´ì‹œì½”ë“œì—ì„œ ì œê³µí•˜ëŠ” **ê°€ìƒ í™˜ê²½ êµ¬ì¶• ë„êµ¬**
- VirtualBox 6.1 ë²„ì „ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” Vagrant 2.2.1 ë³´ë‹¤ ë†’ì€ ë²„ì „ì„ ì‚¬ìš©í•´ì•¼ í•¨

### #1 ê¸°ì¡´ì— ì‹¤í–‰ ì¤‘ ê°€ìƒë¨¸ì‹ ì„ ëª¨ë‘ ì¤‘ì§€ (poweroff)

### #2 Vagrant ì„¤ì¹˜

- [https://www.vagrantup.com/](https://www.vagrantup.com/) ì—ì„œ í™˜ê²½ì— ë§ëŠ” ì„¤ì¹˜ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ ë°›ì•„ì„œ ì„¤ì¹˜

![Untitled.png](6/Untitled.png)

### #3 ì‘ì—… ë””ë ‰í„°ë¦¬ ìƒì„±

- `gim-yujin/VirtualBox VMs/Hashcorp/WorkDir` ìœ„ì¹˜ì—ì„œ ì‹¤í–‰
- ê·¸ ìœ„ì¹˜ì—ì„œ `vagrant init`

```c
âœ WorkDir ls
Vagrantfile
```

### #4 Vagrantfile ìˆ˜ì •

```c
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
# config.vm.box = "centos/7"
  config.vm.box = "generic/centos7"
  config.vm.hostname = "demo"
  config.vm.network "private_network", ip: "192.168.33.10"
  config.vm.synced_folder ".", "/home/vagrant/sync", disabled: true
end
```

### #5 ê°€ìƒë¨¸ì‹ ì„ ìƒì„±í•˜ê³  ê¸°ë™

- `vagrant up` ëª…ë ¹ì„ ì‹¤í–‰

```c
âœ WorkDir vagrant up                 
Bringing machine 'default' up with 'virtualbox' provider...
==> default: Box 'generic/centos7' could not be found. Attempting to find and install...
    default: Box Provider: virtualbox
    default: Box Version: >= 0
==> default: Loading metadata for box 'generic/centos7'
    default: URL: https://vagrantcloud.com/generic/centos7
==> default: Adding box 'generic/centos7' (v3.0.30) for provider: virtualbox
    default: Downloading: https://vagrantcloud.com/generic/boxes/centos7/versions/3.0.30/providers/virtualbox.box
Download redirected to host: vagrantcloud-files-production.s3.amazonaws.com
    default: Calculating and comparing box checksum...
==> default: Successfully added box 'generic/centos7' (v3.0.30) for 'virtualbox'!
==> default: Importing base box 'generic/centos7'...
==> default: Matching MAC address for NAT networking...
==> default: Checking if box 'generic/centos7' version '3.0.30' is up to date...
==> default: Setting the name of the VM: WorkDir_default_1599637138299_69582
==> default: Clearing any previously set network interfaces...
==> default: Preparing network interfaces based on configuration...
    default: Adapter 1: nat
    default: Adapter 2: hostonly
==> default: Forwarding ports...
    default: 22 (guest) => 2222 (host) (adapter 1)
==> default: Running 'pre-boot' VM customizations...

...
    default: Guest Additions Version: 5.2.44
    default: VirtualBox Version: 6.1
==> default: Setting hostname...
==> default: Configuring and enabling network interfaces...
```

### #6 ê°€ìƒ ë¨¸ì‹ ìœ¼ë¡œ ì ‘ì†

**#6-1 virtualBox ì‚¬ìš©**

![/Untitled%201.png](6/Untitled1.png)

- id, pw : vagrant ë¡œ ë¡œê·¸ì¸ ê°€ëŠ¥

**#6-2 ssh ì ‘ì†**

- terminalì—ì„œ sshë¡œ ì ‘ì†

```c
âœ WorkDir vagrant ssh
[vagrant@demo ~]$
```

- id, pw ì„¤ì • ì—†ì´ ë°”ë¡œ ë¡œê·¸ì¸

â†’ ê°€ìƒ ë¨¸ì‹ ì´ ì¤‘ì§€ëœ ê²½ìš°ì—ëŠ” `vagrant up` ì„ í•œ í›„ `vagrant ssh` ë¥¼ í•˜ë©´ ì‹¤í–‰ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### #7 snapshot ì°ê¸°

```c
âœ WorkDir vagrant snapshot save FirstSnapshot
==> default: Snapshotting the machine as 'FirstSnapshot'...
==> default: Snapshot saved! You can restore the snapshot at any time by
==> default: using `vagrant snapshot restore`. You can delete it using
==> default: `vagrant snapshot delete`.
```

- virtualboxë¥¼ CLIë¥¼ ì´ìš©í•˜ì—¬ ì¡°ì‘ì´ ê°€ëŠ¥í•˜ë‹¤.

---

## ğŸ¤§ Vagrantë¥¼ ì´ìš©í•´ì„œ ì›¹ ì„œë²„ê°€ ì„¤ì¹˜ëœ ê°€ìƒ ë¨¸ì‹ ì„ ë°°í¬ (P66)

- [https://www.vagrantup.com/docs/provisioning](https://www.vagrantup.com/docs/provisioning)

### #1 Vagrantfile ìˆ˜ì •

```c
# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure("2") do |config|
# config.vm.box = "centos/7"
  config.vm.box = "generic/centos7"
  config.vm.hostname = "demo"
  config.vm.network "private_network", ip: "192.168.33.10"
  config.vm.synced_folder ".", "/home/vagrant/sync", disabled: true
	config.vm.provision "shell", inline: $script
end

$script = <<SCRIPT
  yum -y install epel-release
  yum -y install nginx
  echo "hello, vagrant" > /usr/shere/nginx/html/index.html
  systemctl start nginx
SCRIPT
```

### #2 provision ì‹¤í–‰í•˜ê¸°

- destroy í›„ì— ë‹¤ì‹œ upí•˜ê±°ë‚˜
- vagrant provision ëª…ë ¹ìœ¼ë¡œ ì‹¤í–‰

### **#3 ê²°ê³¼ë¥¼ í™•ì¸**

```python
C:\HashiCorp\WorkDir> vagrant ssh	â‡ í˜¸ìŠ¤íŠ¸ PCì—ì„œ ê°€ì‹ ë¨¸ì‹ ìœ¼ë¡œ SSHë¡œ ì ‘ì†

[vagrant@demo ~]$ cat /usr/share/nginx/html/index.html	â‡ nginx ì„¤ì¹˜ ì—¬ë¶€ ë° index.html íŒŒì¼ ìˆ˜ì • ì—¬ë¶€ë¥¼ í™•ì¸
Hello, Vagrant

[vagrant@demo ~]$ sudo systemctl stop firewalld	â‡ ë°©í™”ë²½ í•´ì œ

[vagrant@demo ~]$ exit	â‡ ê°€ìƒë¨¸ì‹ ì— ë¹ ì ¸ ë‚˜ì˜´
logout
Connection to 127.0.0.1 closed.

C:\HashiCorp\WorkDir> curl http://192.168.33.10	â‡ ê°€ìƒë¨¸ì‹ (nginxì„œë²„)ì—ê²Œ ì›¹ í˜ì´ì§€(index.html)ë¥¼ ìš”ì²­
Hello, Vagrant	â‡ index.html íŒŒì¼ì˜ ë‚´ìš©ì„ ë°˜í™˜
```

- ì›¹ì—ì„œ  [`http://192.168.33.10`](http://192.168.33.10)  ìœ¼ë¡œ ì ‘ì† ê°€ëŠ¥

![ntitled%202.png](6/Untitled2.png)

---

## ğŸ˜ Vagrantfileì—ì„œ Infrastructure as Codeë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì˜ ì˜ì˜

### vagrantë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì˜ ì¥ì 

1. í™˜ê²½ êµ¬ì¶• ì‘ì—…ì˜ ê°„ì†Œí™”
    - Vagrantfileì— ê¸°ìˆ í•˜ê¸°ë§Œ í•˜ë©´ ëˆ„êµ¬ë¼ë„ vgrant up ëª…ë ¹ì„ í†µí•´ ë™ì¼í•œ í™˜ê²½ì„ ê°„ë‹¨í•˜ê²Œ êµ¬ì¶•

2. í™˜ê²½ ê³µìœ ê°€ ìš©ì´
    - Vagrantfileì„ ê³µìœ í•˜ì—¬ í™˜ê²½ ì •ë³´ë¥¼ ì‰½ê²Œ ê³µìœ 
3. íŒ€ ì°¨ì›ì˜ ìœ ì§€ ë³´ìˆ˜ê°€ ê°€ëŠ¥
    - íŒ€ ë©¤ë²„ ëˆ„êµ¬ë¼ë„ ì´ íŒŒì¼ì„ ì°¸ì¡°í•˜ì—¬ vagrant upì„ ì‹¤í–‰í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ í™˜ê²½ì„ ì´ìš©í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥